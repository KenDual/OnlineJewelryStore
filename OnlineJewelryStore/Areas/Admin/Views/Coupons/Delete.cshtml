@model OnlineJewelryStore.Models.Coupon

@{
    ViewBag.Title = "Xóa Mã Giảm Giá";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    var hasBeenUsed = (bool)ViewBag.HasBeenUsed;
    var usageCount = (int)ViewBag.UsageCount;
}

<div class="container-fluid px-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Dashboard")">
                    <i class="bi bi-house-door"></i> Dashboard
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Coupons")">
                    <i class="bi bi-ticket-perforated"></i> Mã Giảm Giá
                </a>
            </li>
            <li class="breadcrumb-item active">Xóa Mã</li>
        </ol>
    </nav>

    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-1">
                        <i class="bi bi-trash text-danger"></i>
                        Xóa Mã Giảm Giá
                    </h2>
                    <p class="text-muted mb-0">Xác nhận xóa mã giảm giá khỏi hệ thống</p>
                </div>
                <div>
                    <a href="@Url.Action("Index")" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Quay Lại
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8 mx-auto">
            @if (hasBeenUsed)
            {
                <!-- Cannot Delete - Used Coupon -->
                <div class="card border-danger border-3 shadow-lg">
                    <div class="card-header bg-danger text-white py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            Không Thể Xóa Mã Giảm Giá
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <!-- Coupon Info -->
                        <div class="text-center mb-4 pb-4 border-bottom">
                            <div class="bg-danger bg-opacity-10 rounded-circle d-inline-flex p-4 mb-3">
                                <i class="bi bi-ticket-perforated text-danger display-3"></i>
                            </div>
                            <h3 class="fw-bold text-primary mb-2">@Model.Code</h3>
                            <span class="badge bg-danger fs-5 px-4 py-2">
                                <i class="bi bi-percent"></i>
                                @Model.PercentOff.ToString("0.##")% OFF
                            </span>
                        </div>

                        <!-- Warning Message -->
                        <div class="alert alert-danger border-danger" role="alert">
                            <h5 class="alert-heading">
                                <i class="bi bi-exclamation-octagon-fill"></i>
                                Mã Giảm Giá Đã Được Sử Dụng
                            </h5>
                            <hr>
                            <p class="mb-0">
                                Mã coupon <strong>@Model.Code</strong> đã được sử dụng trong
                                <strong class="text-danger">@usageCount đơn hàng</strong>.
                                Việc xóa mã này sẽ ảnh hưởng đến dữ liệu lịch sử đơn hàng của khách hàng.
                            </p>
                        </div>

                        <!-- Usage Statistics -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="card bg-light border-0">
                                    <div class="card-body text-center">
                                        <i class="bi bi-cart-check text-primary fs-3"></i>
                                        <div class="fs-4 fw-bold text-primary mt-2">@usageCount</div>
                                        <div class="small text-muted">Đơn Hàng</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light border-0">
                                    <div class="card-body text-center">
                                        <i class="bi bi-people text-success fs-3"></i>
                                        <div class="fs-4 fw-bold text-success mt-2">@Model.Orders.Select(o => o.UserID).Distinct().Count()</div>
                                        <div class="small text-muted">Khách Hàng</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light border-0">
                                    <div class="card-body text-center">
                                        <i class="bi bi-cash-coin text-warning fs-3"></i>
                                        <div class="fs-4 fw-bold text-warning mt-2">@Model.Orders.Sum(o => o.DiscountTotal).ToString("N0")₫</div>
                                        <div class="small text-muted">Tổng Giảm</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Alternative Actions -->
                        <div class="bg-light rounded p-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-lightbulb text-warning"></i>
                                Bạn Có Thể Thực Hiện:
                            </h6>
                            <div class="d-flex mb-3">
                                <i class="bi bi-check-circle-fill text-success fs-5 me-3"></i>
                                <div>
                                    <strong>Vô Hiệu Hóa Mã</strong>
                                    <p class="text-muted small mb-0">
                                        Tắt mã để không cho phép sử dụng tiếp, nhưng vẫn giữ lịch sử
                                    </p>
                                </div>
                            </div>
                            <div class="d-flex mb-3">
                                <i class="bi bi-check-circle-fill text-success fs-5 me-3"></i>
                                <div>
                                    <strong>Chỉnh Sửa Mã</strong>
                                    <p class="text-muted small mb-0">
                                        Thay đổi phần trăm giảm giá hoặc trạng thái
                                    </p>
                                </div>
                            </div>
                            <div class="d-flex">
                                <i class="bi bi-check-circle-fill text-success fs-5 me-3"></i>
                                <div>
                                    <strong>Tạo Mã Mới</strong>
                                    <p class="text-muted small mb-0">
                                        Tạo mã giảm giá mới thay thế cho mã này
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2 mt-4">
                            <a href="@Url.Action("Index")" class="btn btn-secondary flex-fill">
                                <i class="bi bi-arrow-left"></i> Quay Lại Danh Sách
                            </a>
                            <a href="@Url.Action("Edit", new { id = Model.CouponID })" class="btn btn-primary flex-fill">
                                <i class="bi bi-pencil"></i> Chỉnh Sửa Mã
                            </a>
                        </div>
                    </div>
                </div>
            }
            else
            {
                <!-- Can Delete - Unused Coupon -->
                <div class="card border-warning border-3 shadow-lg">
                    <div class="card-header bg-warning py-3">
                        <h5 class="mb-0">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            Xác Nhận Xóa Mã Giảm Giá
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <!-- Coupon Info -->
                        <div class="text-center mb-4 pb-4 border-bottom">
                            <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex p-4 mb-3">
                                <i class="bi bi-ticket-perforated text-warning display-3"></i>
                            </div>
                            <h3 class="fw-bold text-primary mb-2">@Model.Code</h3>
                            <span class="badge bg-success fs-5 px-4 py-2">
                                <i class="bi bi-percent"></i>
                                @Model.PercentOff.ToString("0.##")% OFF
                            </span>
                        </div>

                        <!-- Coupon Details -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="border-start border-primary border-4 ps-3 mb-3">
                                    <small class="text-muted d-block">Mã Coupon</small>
                                    <strong class="fs-5 text-primary">@Model.Code</strong>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="border-start border-success border-4 ps-3 mb-3">
                                    <small class="text-muted d-block">Phần Trăm Giảm</small>
                                    <strong class="fs-5 text-success">@Model.PercentOff.ToString("0.##")%</strong>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="border-start border-info border-4 ps-3">
                                    <small class="text-muted d-block">Lượt Sử Dụng</small>
                                    <strong class="fs-5 text-info">0 lượt</strong>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="border-start border-secondary border-4 ps-3">
                                    <small class="text-muted d-block">Trạng Thái</small>
                                    @if (Model.IsActive)
                                    {
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle"></i> Đang hoạt động
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">
                                            <i class="bi bi-x-circle"></i> Đã vô hiệu hóa
                                        </span>
                                    }
                                </div>
                            </div>
                        </div>

                        <!-- Warning Message -->
                        <div class="alert alert-warning border-warning" role="alert">
                            <h6 class="alert-heading">
                                <i class="bi bi-exclamation-triangle-fill"></i>
                                Cảnh Báo
                            </h6>
                            <p class="mb-0">
                                Bạn có chắc chắn muốn xóa mã giảm giá <strong>@Model.Code</strong> không?
                                Hành động này <strong class="text-danger">không thể hoàn tác</strong>.
                            </p>
                        </div>

                        <!-- Info Message -->
                        <div class="bg-light rounded p-3 mb-4">
                            <small class="text-muted">
                                <i class="bi bi-info-circle text-primary"></i>
                                Mã này chưa được sử dụng trong bất kỳ đơn hàng nào,
                                nên có thể xóa an toàn khỏi hệ thống.
                            </small>
                        </div>

                        <!-- Delete Form -->
                        @using (Html.BeginForm("Delete", "Coupons", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            @Html.HiddenFor(m => m.CouponID)

                            <div class="d-flex gap-2">
                                <a href="@Url.Action("Index")" class="btn btn-lg btn-secondary flex-fill">
                                    <i class="bi bi-x-circle"></i> Hủy
                                </a>
                                <button type="submit" class="btn btn-lg btn-danger flex-fill" id="deleteBtn">
                                    <i class="bi bi-trash"></i> Xác Nhận Xóa
                                </button>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Confirm delete
            $('#deleteBtn').on('click', function (e) {
                if (!confirm('BẠN CÓ CHẮC CHẮN MUỐN XÓA MÃ GIẢM GIÁ "@Model.Code" KHÔNG?\n\nHành động này không thể hoàn tác!')) {
                    e.preventDefault();
                    return false;
                }
            });

            // Add animation on page load
            $('.card').hide().fadeIn(500);
        });
    </script>

    <style>
        .card {
            animation: slideUp 0.5s ease;
        }

        @@keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .border-start {
            border-width: 4px !important;
        }

        .alert {
            animation: pulse 2s infinite;
        }

        @@keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.9;
            }
        }
    </style>
}